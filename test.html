<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TMDb API æ¸¬è©¦ - é›»å½±æ¼”å“¡æŸ¥è©¢</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
      }

      .container {
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        padding: 40px;
        max-width: 800px;
        width: 100%;
      }

      h1 {
        color: #333;
        margin-bottom: 10px;
        font-size: 28px;
        text-align: center;
      }

      .subtitle {
        color: #666;
        text-align: center;
        margin-bottom: 30px;
        font-size: 14px;
      }

      .api-key-section {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 30px;
      }

      .api-key-section label {
        display: block;
        color: #555;
        font-weight: 600;
        margin-bottom: 8px;
        font-size: 14px;
      }

      .api-key-section input {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 14px;
        transition: border-color 0.3s;
      }

      .api-key-section input:focus {
        outline: none;
        border-color: #667eea;
      }

      .api-key-section small {
        display: block;
        color: #888;
        margin-top: 8px;
        font-size: 12px;
      }

      .search-box {
        display: flex;
        gap: 10px;
        margin-bottom: 30px;
      }

      input[type='text'] {
        flex: 1;
        padding: 15px 20px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-size: 16px;
        transition: all 0.3s;
      }

      input[type='text']:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      button {
        padding: 15px 30px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
      }

      button:active {
        transform: translateY(0);
      }

      button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .loading {
        text-align: center;
        color: #667eea;
        font-size: 16px;
        margin: 20px 0;
      }

      .error {
        background: #fee;
        color: #c33;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
        border-left: 4px solid #c33;
      }

      .movie-info {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
      }

      .movie-info h2 {
        color: #333;
        margin-bottom: 10px;
        font-size: 24px;
      }

      .movie-meta {
        color: #666;
        font-size: 14px;
        margin-bottom: 10px;
      }

      .cast-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .cast-card {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s, box-shadow 0.3s;
      }

      .cast-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
      }

      .cast-image {
        width: 100%;
        height: 200px;
        object-fit: cover;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 48px;
      }

      .cast-info {
        padding: 12px;
      }

      .cast-name {
        font-weight: 600;
        color: #333;
        margin-bottom: 4px;
        font-size: 14px;
      }

      .cast-character {
        color: #888;
        font-size: 12px;
      }

      .no-results {
        text-align: center;
        color: #888;
        padding: 40px;
        font-size: 16px;
      }

      @media (max-width: 600px) {
        .container {
          padding: 20px;
        }

        h1 {
          font-size: 24px;
        }

        .search-box {
          flex-direction: column;
        }

        .cast-grid {
          grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
          gap: 15px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ¬ TMDb é›»å½±æ¼”å“¡æŸ¥è©¢</h1>
      <p class="subtitle">The Movie Database API æ¸¬è©¦å·¥å…·</p>

      <!-- API Key è¼¸å…¥å€ -->
      <div class="api-key-section">
        <label for="apiKey">TMDb API Key</label>
        <input
          type="text"
          id="apiKey"
          placeholder="è«‹è¼¸å…¥æ‚¨çš„ TMDb API Key"
          value=""
        />
        <small>
          é‚„æ²’æœ‰ API Keyï¼Ÿè«‹å‰å¾€
          <a
            href="https://www.themoviedb.org/settings/api"
            target="_blank"
            style="color: #667eea"
          >
            TMDb å®˜ç¶²ç”³è«‹
          </a>
        </small>
      </div>

      <!-- æœå°‹æ¡† -->
      <div class="search-box">
        <input
          type="text"
          id="movieInput"
          placeholder="è¼¸å…¥é›»å½±åç¨±ï¼ˆä¾‹å¦‚ï¼šå¾©ä»‡è€…è¯ç›Ÿã€æ˜Ÿéš›æ•ˆæ‡‰ï¼‰"
          onkeypress="if(event.key === 'Enter') searchMovie()"
        />
        <button onclick="searchMovie()">æœå°‹</button>
      </div>

      <!-- è¼‰å…¥ä¸­ -->
      <div id="loading" class="loading" style="display: none">
        æ­£åœ¨æœå°‹ä¸­...
      </div>

      <!-- éŒ¯èª¤è¨Šæ¯ -->
      <div id="error" class="error" style="display: none"></div>

      <!-- é›»å½±è³‡è¨Š -->
      <div id="movieInfo" style="display: none"></div>

      <!-- æ¼”å“¡åˆ—è¡¨ -->
      <div id="results"></div>
    </div>

    <script>
      const TMDB_BASE_URL = 'https://api.themoviedb.org/3';

      async function searchMovie() {
        const apiKey = document.getElementById('apiKey').value.trim();
        const movieName = document.getElementById('movieInput').value.trim();
        const loading = document.getElementById('loading');
        const error = document.getElementById('error');
        const results = document.getElementById('results');
        const movieInfo = document.getElementById('movieInfo');

        // æ¸…ç©ºä¹‹å‰çš„çµæœ
        results.innerHTML = '';
        movieInfo.style.display = 'none';
        error.style.display = 'none';

        // é©—è­‰è¼¸å…¥
        if (!apiKey) {
          showError('è«‹å…ˆè¼¸å…¥ TMDb API Key');
          return;
        }

        if (!movieName) {
          showError('è«‹è¼¸å…¥é›»å½±åç¨±');
          return;
        }

        // é¡¯ç¤ºè¼‰å…¥ä¸­
        loading.style.display = 'block';

        try {
          // Step 1: æœå°‹é›»å½±
          const searchUrl = `${TMDB_BASE_URL}/search/movie?api_key=${apiKey}&language=zh-TW&query=${encodeURIComponent(
            movieName
          )}`;
          const searchResponse = await fetch(searchUrl);

          if (!searchResponse.ok) {
            if (searchResponse.status === 401) {
              throw new Error('API Key ç„¡æ•ˆï¼Œè«‹æª¢æŸ¥æ‚¨çš„ API Key æ˜¯å¦æ­£ç¢º');
            }
            throw new Error(
              `HTTP ${searchResponse.status}: ${searchResponse.statusText}`
            );
          }

          const searchData = await searchResponse.json();

          if (!searchData.results || searchData.results.length === 0) {
            results.innerHTML =
              '<div class="no-results">æ‰¾ä¸åˆ°ç›¸é—œé›»å½±ï¼Œè«‹å˜—è©¦å…¶ä»–é—œéµå­—</div>';
            loading.style.display = 'none';
            return;
          }

          // å–å¾—ç¬¬ä¸€å€‹çµæœ
          const movie = searchData.results[0];

          // Step 2: ç²å–æ¼”å“¡è³‡è¨Š
          const creditsUrl = `${TMDB_BASE_URL}/movie/${movie.id}/credits?api_key=${apiKey}&language=zh-TW`;
          const creditsResponse = await fetch(creditsUrl);
          const creditsData = await creditsResponse.json();

          // é¡¯ç¤ºé›»å½±è³‡è¨Š
          displayMovieInfo(movie);

          // é¡¯ç¤ºæ¼”å“¡åˆ—è¡¨
          displayCast(creditsData.cast || []);
        } catch (err) {
          showError(err.message);
        } finally {
          loading.style.display = 'none';
        }
      }

      function displayMovieInfo(movie) {
        const movieInfo = document.getElementById('movieInfo');
        const releaseYear = movie.release_date
          ? movie.release_date.split('-')[0]
          : 'æœªçŸ¥';
        const rating = movie.vote_average
          ? movie.vote_average.toFixed(1)
          : 'N/A';

        movieInfo.innerHTML = `
                <h2>${movie.title}</h2>
                <div class="movie-meta">
                    ğŸ“… ä¸Šæ˜ å¹´ä»½: ${releaseYear} | 
                    â­ è©•åˆ†: ${rating}/10 | 
                    ğŸ†” TMDb ID: ${movie.id}
                </div>
                ${
                  movie.overview
                    ? `<p style="color: #666; margin-top: 10px; line-height: 1.6;">${movie.overview}</p>`
                    : ''
                }
            `;
        movieInfo.style.display = 'block';
      }

      function displayCast(cast) {
        const results = document.getElementById('results');

        if (cast.length === 0) {
          results.innerHTML =
            '<div class="no-results">æ­¤é›»å½±æ²’æœ‰æ¼”å“¡è³‡è¨Š</div>';
          return;
        }

        // åªé¡¯ç¤ºå‰ 12 ä½æ¼”å“¡
        const topCast = cast.slice(0, 12);

        const castHTML = topCast
          .map((actor) => {
            const imageUrl = actor.profile_path
              ? `https://image.tmdb.org/t/p/w185${actor.profile_path}`
              : null;

            return `
                    <div class="cast-card">
                        ${
                          imageUrl
                            ? `<img src="${imageUrl}" alt="${actor.name}" class="cast-image">`
                            : `<div class="cast-image">ğŸ‘¤</div>`
                        }
                        <div class="cast-info">
                            <div class="cast-name">${actor.name}</div>
                            <div class="cast-character">${
                              actor.character || 'æœªçŸ¥è§’è‰²'
                            }</div>
                        </div>
                    </div>
                `;
          })
          .join('');

        results.innerHTML = `
                <h3 style="margin-bottom: 15px; color: #333;">ä¸»è¦æ¼”å“¡é™£å®¹ (${cast.length} ä½)</h3>
                <div class="cast-grid">${castHTML}</div>
            `;
      }

      function showError(message) {
        const error = document.getElementById('error');
        error.textContent = 'âŒ ' + message;
        error.style.display = 'block';
      }

      // é é¢è¼‰å…¥æ™‚æª¢æŸ¥æ˜¯å¦æœ‰å„²å­˜çš„ API Key
      window.addEventListener('DOMContentLoaded', () => {
        const savedApiKey = localStorage.getItem('tmdb_api_key');
        if (savedApiKey) {
          document.getElementById('apiKey').value = savedApiKey;
        }

        // å„²å­˜ API Key åˆ° localStorage
        document.getElementById('apiKey').addEventListener('change', (e) => {
          localStorage.setItem('tmdb_api_key', e.target.value);
        });
      });
    </script>
  </body>
</html>
